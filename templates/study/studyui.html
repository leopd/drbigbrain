{% extends "djbase.html" %}

{# setting the <title> attribute #}
{% block dojango_page_title %}Dr. Bigbrain Online Studying{% endblock %}
{% block dojango_header_extra %}
<style type="text/css">
    .box {
        margin-top: 10px;
        color: #292929;
        width: 300px;
        border: 1px solid #BABABA;
        background-color: #ddd;
        padding-left: 10px;
        padding-right: 10px;
        margin-left: 10px;
        margin-bottom: 1em;
        -o-border-radius: 10px;
        -moz-border-radius: 12px;
        -webkit-border-radius: 10px;
        -webkit-box-shadow: 0px 3px 7px #adadad;
        border-radius: 10px;
        -moz-box-sizing: border-box;
        -opera-sizing: border-box;
        -webkit-box-sizing: border-box;
        -khtml-box-sizing: border-box;
        box-sizing: border-box;
        overflow: hidden;
    }

    .qacard {
	font-size: 30px;
        border: 1px solid #BABABA;
	margin: 10px;
	padding: 5px;
    }

    .uihints {
	margin-top: 20px;
	font-size: 8px;
    }

</style>
<script type="text/javascript">
    // load required modules
    dojo.require("dojo.parser");

    // vars
    var revealAnswer;
    var conceptNum;

    function showQA(q,a) {
	dojo.byId("questionContents").innerHTML= q;
	dojo.byId("answerContents").innerHTML= a;
    }


    function fetchQA() {
	dojo.xhrGet( {
	    url: "/study/getqa",
	    handleAs: "json",
	    load: function(responseObject, ioArgs) {
		showQA(responseObject.question, responseObject.answer);
		conceptNum = responseObject.concept;
		dojo.byId("revealButton").focus();
	    }
	});
    }



    dojo.addOnLoad(function(){
	var node = dojo.byId("bodytag");
	dojo.connect(node, "onkeypress", function(e){
	    switch(e.charOrCode){
		case 'r':
		case 'R':
		    revealAnswer();
		    break;
		case 'n':
		case 'N':
		    submitAnswer('no');
		    break;
		case 'y':
		case 'Y':
		    submitAnswer('yes');
		    break;
	    }
	    // dojo.stopEvent(e);
	});
		    
		
	startUI();
    });

    function startUI() {
	fetchQA();
    }

    function revealAnswer()
    {
	dojo.byId("answerDiv").style.display="block";
	dojo.byId("revealButton").blur();
    }
    function hideAnswer()
    {
	dojo.byId("answerDiv").style.display="none";
    }

    function submitAnswer(yesno)
    {
	//TODO: more general way to create postdata
	var xhrArgs = {
	    url: "/study/impression",
	    postData: "answer=" + yesno + "&concept=" + conceptNum,
	    handleAs: "text",
	    load: function(data) {
		console.dir("impression "+yesno+" posted");
		console.dir(data);
	    },
	    error: function(error) {
		console.dir("error: "+error);
	    }
	};
	dojo.xhrPost(xhrArgs);
	// some XHR here.
	showQA("...","...");
	hideAnswer();
	fetchQA();
    }

</script>
{% endblock %}
{% block dojango_content %}
<div id="questionDiv" class="box">
What does this mean?

<div id="questionContents" class="qacard">
<i>loading...</i>
</div>
</div>
<button id="revealButton" onClick="javascript:revealAnswer();">Reveal Answer</button>
<div id="answerDiv" class="box" style="display:none" >
<div id="answerContents" class="qacard" >
<i>loading...</i>
</div>
Did you know this one?
<button id="yesButton" onClick="submitAnswer('yes');">Yes</button>
<button id="noButton" onClick="submitAnswer('no');">No</button>
</div>

<div class="uihints">
Hint:
Try pressing R, N, and Y keys.
</div>
{% endblock %}


